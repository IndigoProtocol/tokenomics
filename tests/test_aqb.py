import pytest

from tokenomics import aqb


@pytest.mark.parametrize(
    "vy,vn,e,passed",
    [
        (103487, 2483697, 4071498, False),
        (1072363, 8676395, 15401432, False),
        (1079245, 2004314, 24859696, False),
        (11334486, 350551, 19141120, True),
        (11954130, 1182277, 12772809, True),
        (12054235, 1962317, 19083587, True),
        (12204465, 8136310, 22362987, True),
        (1236098, 390346, 15665132, True),
        (12363, 193700, 9093563, False),
        (1284917, 4068905, 5739132, False),
        (13173145, 1145491, 18968521, True),
        (1337070, 445690, 15612392, True),
        (1358708, 582304, 12679313, False),
        (1389399, 1136782, 6754992, False),
        (13971016, 4411900, 19932201, True),
        (141848, 403721, 26408298, False),
        (143367, 127137, 1979845, False),
        (14566346, 2176581, 18393191, True),
        (1459306, 7661359, 8513720, False),
        (1497484, 4492454, 19932201, False),
        (15045209, 15045208, 29256186, True),
        (15264795, 2484966, 28227782, True),
        (159045, 15745541, 21338172, False),
        (16108, 98950, 10291609, False),
        (16134820, 9889083, 28702430, True),
        (1661141, 10204158, 28069566, False),
        (16877247, 1270331, 24071012, True),
        (1714822, 4198359, 15401432, False),
        (17178260, 2123155, 22226345, True),
        (1772066, 264791, 28227782, True),
        (185945, 18408654, 26882946, False),
        (1868309, 7473237, 13896539, False),
        (19472620, 3709071, 25775434, True),
        (199816, 3796517, 7915894, False),
        (200409, 2662590, 19741623, False),
        (20180359, 840848, 21611456, True),
        (201936, 165220, 6211101, False),
        (2055773, 4575754, 12070700, False),
        (2177730, 1931195, 3091599, True),
        (2218464, 68612, 20059253, True),
        (2317210, 408919, 9682996, True),
        (245366, 4661963, 12070700, False),
        (2462183, 1641456, 26487406, False),
        (2677244, 8031733, 23046197, False),
        (27227772, 555669, 29018862, True),
        (2737223, 7400639, 15506912, False),
        (284841, 2088838, 16321982, False),
        (2889344, 591793, 15257596, True),
        (3042954, 194231, 8597626, True),
        (3187013, 6772404, 16839788, False),
        (331716, 10725512, 28227782, False),
        (339361, 138613, 6826914, False),
        (344221, 5392808, 4723272, False),
        (3490488, 13961955, 29256186, False),
        (3522717, 5284077, 13428170, False),
        (3630348, 907587, 15612392, True),
        (370808, 5809327, 7806813, False),
        (3907641, 532860, 26882946, True),
        (3929178, 3929178, 6390906, True),
        (3929179, 3929177, 6390906, True),
        (420045, 62765, 23387802, False),
        (4382686, 541680, 26487406, True),
        (4384622, 330025, 9682996, True),
        (4396527, 10258565, 25775434, False),
        (4437055, 493006, 9177469, True),
        (444099, 14359228, 18105526, False),
        (460893, 3729046, 7442727, False),
        (4642073, 6153445, 28306890, False),
        (4681271, 578585, 15823352, True),
        (4912081, 16444797, 27990458, False),
        (4953705, 9199740, 27436702, False),
        (4967938, 876695, 25696326, True),
        (526728, 859400, 14551898, False),
        (544292, 851330, 14645392, False),
        (5467859, 7248093, 19198653, False),
        (5498582, 11163788, 18738389, False),
        (5576651, 7392305, 14083531, False),
        (5707376, 1802329, 10385105, True),
        (576785, 368764, 18278125, False),
        (5772352, 1924117, 15454172, True),
        (5911221, 5911222, 27278486, False),
        (6036653, 3699884, 17069924, True),
        (619046, 8224470, 17415128, False),
        (6278982, 1669097, 27515810, True),
        (6310057, 779895, 6826914, True),
        (6324939, 5608908, 26882946, False),
        (6569686, 895867, 8392655, True),
        (6723885, 5501361, 10946970, True),
        (6769594, 3334278, 16206914, True),
        (6825894, 1601135, 24002691, True),
        (7336791, 7049074, 17127458, False),
        (737347, 2212042, 4071498, False),
        (7435660, 11153490, 18335658, False),
        (7922730, 8934142, 25082638, False),
        (7935584, 1741958, 11040466, True),
        (873123, 65719, 1910319, True),
        (955160, 955160, 1910319, False),
        (9619622, 7870600, 18795922, True),
        (9624647, 8884290, 22977876, False),
        (981701, 7199147, 9547547, False),
        (997799, 1496698, 1948679, False),
    ],
)
def test_has_passed(vy: int, vn: int, e: int, passed: bool) -> None:
    assert aqb.has_passed(vy, vn, e) == passed

    if passed:
        assert vy > aqb.calculate_yes_votes(vn, e)

    else:
        assert vy < aqb.calculate_yes_votes(vn, e)


@pytest.mark.parametrize(
    "vn,e,expected_vy",
    [
        (0, 10000, 100),
        (0, 1910319, 1383),
        (1000, 1910319, 13045),
        (65719, 1910319, 183378),
        (1496698, 1948679, 1259813),
        (127137, 1979845, 281316),
        (1931195, 3091599, 1767390),
        (2212042, 4071498, 2141265),
        (2483697, 4071498, 2294661),
        (5392808, 4723272, 3856011),
        (4068905, 5739132, 3536897),
        (165220, 6211101, 505333),
        (3929178, 6390906, 3618173),
        (3929177, 6390906, 3618172),
        (1136782, 6754992, 1743494),
        (779895, 6826914, 1386933),
        (138613, 6826914, 467726),
        (3729046, 7442727, 3728154),
        (5809327, 7806813, 4951021),
        (3796517, 7915894, 3862478),
        (895867, 8392655, 1634463),
        (7661359, 8513720, 6041784),
        (194231, 8597626, 630177),
        (193700, 9093563, 641980),
        (493006, 9177469, 1163467),
        (7199147, 9547547, 6102345),
        (408919, 9682996, 1054847),
        (330025, 9682996, 921200),
        (98950, 10291609, 436868),
        (1802329, 10385105, 2731107),
        (5501361, 10946970, 5492841),
        (1741958, 11040466, 2737944),
        (4575754, 12070700, 5111272),
        (4661963, 12070700, 5169212),
        (582304, 12679313, 1455915),
        (1182277, 12772809, 2275775),
        (5284077, 13428170, 5815617),
        (7473237, 13896539, 7261334),
        (7392305, 14083531, 7252914),
        (859400, 14551898, 1957216),
        (851330, 14645392, 1950283),
        (591793, 15257596, 1574475),
        (8676395, 15401432, 8274314),
        (4198359, 15401432, 5339053),
        (1924117, 15454172, 3310121),
        (7400639, 15506912, 7542812),
        (445690, 15612392, 1326724),
        (907587, 15612392, 2079026),
        (390346, 15665132, 1221035),
        (578585, 15823352, 1573022),
        (3334278, 16206914, 4730656),
        (2088838, 16321982, 3555984),
        (6772404, 16839788, 7389184),
        (3699884, 17069924, 5144279),
        (7049074, 17127458, 7620810),
        (8224470, 17415128, 8417518),
        (14359228, 18105526, 11922442),
        (368764, 18278125, 1245246),
        (11153490, 18335658, 10312500),
        (2176581, 18393191, 3817175),
        (11163788, 18738389, 10408927),
        (7870600, 18795922, 8450584),
        (1145491, 18968521, 2586755),
        (1962317, 19083587, 3629494),
        (350551, 19141120, 1225885),
        (7248093, 19198653, 8108588),
        (2662590, 19741623, 4442641),
        (4411900, 19932201, 6084251),
        (4492454, 19932201, 6151984),
        (68612, 20059253, 436750),
        (15745541, 21338172, 13462710),
        (840848, 21611456, 2233884),
        (2123155, 22226345, 4037481),
        (8136310, 22362987, 9236036),
        (8884290, 22977876, 9845230),
        (8031733, 23046197, 9273524),
        (62765, 23387802, 435046),
        (1601135, 24002691, 3483640),
        (1270331, 24071012, 3015472),
        (2004314, 24859696, 4062314),
        (8934142, 25082638, 10226875),
        (876695, 25696326, 2443878),
        (3709071, 25775434, 6036975),
        (10258565, 25775434, 11238253),
        (403721, 26408298, 1506313),
        (541680, 26487406, 1819428),
        (1641456, 26487406, 3670537),
        (532860, 26882946, 1810137),
        (18408654, 26882946, 16223954),
        (5608908, 26882946, 7913582),
        (5911222, 27278486, 8218561),
        (9199740, 27436702, 10784670),
        (1669097, 27515810, 3762104),
        (16444797, 27990458, 15418360),
        (10204158, 28069566, 11586631),
        (10725512, 28227782, 11967495),
        (264791, 28227782, 1176960),
        (2484966, 28227782, 4872641),
        (6153445, 28306890, 8544804),
        (9889083, 28702430, 11469242),
        (555669, 29018862, 1911210),
        (13961955, 29256186, 14228763),
        (15045208, 29256186, 14881192),
    ],
)
def test_calculate_yes_votes(vn: int, e: int, expected_vy: int) -> None:
    assert aqb.calculate_yes_votes(vn, e) == expected_vy
    assert aqb.has_passed(expected_vy, vn, e)
